<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Admin Kecemasan - Hanna</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .emergency-glow { box-shadow: 0 0 20px rgba(220, 38, 38, 0.3); }
        audio::-webkit-media-controls-panel { background-color: #1e293b; }
    </style>
</head>
<body class="bg-[#0f172a] text-white p-8 font-sans">
    
    <!-- AUDIO BARU -->
    <audio id="notifBiasa" src="https://cdn.pixabay.com/download/audio/2024/01/15/audio_7a0e4b5c7b.mp3" preload="auto"></audio>
    <audio id="notifSOS" src="https://cdn.pixabay.com/download/audio/2024/01/18/audio_9b9d79c5b6.mp3" preload="auto"></audio>

    <div id="lock" class="fixed inset-0 bg-[#0f172a] z-50 flex flex-col items-center justify-center">
        <div class="bg-slate-800 p-10 rounded-[3rem] shadow-2xl text-center border-2 border-red-600/30 w-full max-w-sm">
            <h2 class="mb-8 font-black text-2xl uppercase italic">Hanna Access</h2>

            <!-- TEKS AKTIFKAN SUARA DIHAPUS -->

            <input type="password" id="inputPin"
                class="bg-slate-900 text-white p-5 rounded-2xl mb-4 text-center text-2xl font-black w-full border-2 border-slate-700 focus:border-red-500"
                placeholder="****">

            <button onclick="cekLogin()"
                class="bg-red-600 w-full py-5 rounded-2xl font-black hover:bg-red-700 transition uppercase tracking-widest">
                Buka
            </button>
        </div>
    </div>

    <div id="dash" class="hidden max-w-4xl mx-auto">
        <div class="flex justify-between items-end mb-10 border-b-2 border-red-600/20 pb-6">
            <h1 class="text-4xl font-black text-red-600 italic uppercase">Admin Page</h1>
            <button onclick="location.reload()"
                class="bg-slate-800 px-6 py-2 rounded-full text-[10px] font-black uppercase border border-slate-700">
                Logout
            </button>
        </div>

        <div class="flex gap-4 mb-8">
            <button onclick="gantiTab('aktif')" id="tabAktif"
                class="flex-1 py-4 rounded-2xl font-black border-2 border-red-600 bg-red-600">
                ðŸš¨ Aktif (<span id="countAktif">0</span>)
            </button>
            <button onclick="gantiTab('selesai')" id="tabSelesai"
                class="flex-1 py-4 rounded-2xl font-black border-2 border-slate-700 bg-slate-800 text-slate-400">
                âœ… Selesai (<span id="countSelesai">0</span>)
            </button>
        </div>

        <div id="konten" class="space-y-6"></div>
    </div>

    <script>
        let tabSekarang = 'aktif';
        let laporanLama = [];
        const DB_URL = "https://projectkecemasan-default-rtdb.asia-southeast1.firebasedatabase.app/laporan.json";

        function pancingSuara() {
            const b = document.getElementById('notifBiasa');
            const s = document.getElementById('notifSOS');
            b.play().then(() => { b.pause(); b.currentTime = 0; }).catch(()=>{});
            s.play().then(() => { s.pause(); s.currentTime = 0; }).catch(()=>{});
        }

        function cekLogin() {
            if (document.getElementById('inputPin').value === "1234") {
                pancingSuara();
                document.getElementById('lock').classList.add('hidden');
                document.getElementById('dash').classList.remove('hidden');

                fetch(DB_URL).then(res => res.json()).then(data => {
                    if (data) laporanLama = Object.keys(data);
                    tampilData(data ? Object.keys(data).map(k => ({ ...data[k], idFirebase: k })) : []);
                });

                setInterval(ambilDataBaru, 3000);
            } else alert("PIN Salah!");
        }

        function ambilDataBaru() {
            fetch(DB_URL).then(res => res.json()).then(data => {
                if (!data) return;
                const keys = Object.keys(data);

                keys.forEach(key => {
                    if (!laporanLama.includes(key)) {
                        const l = data[key];
                        if (l.prioritas.includes("SOS")) {
                            const s = document.getElementById('notifSOS');
                            s.currentTime = 0;
                            s.play();
                            alert("âš ï¸âš ï¸âš ï¸ PERINGATAN SOS DARI: " + l.nama.toUpperCase());
                        } else {
                            const b = document.getElementById('notifBiasa');
                            b.currentTime = 0;
                            b.play();
                        }
                        laporanLama.push(key);
                    }
                });

                tampilData(keys.map(k => ({ ...data[k], idFirebase: k })));
            });
        }

        function gantiTab(t) { tabSekarang = t; ambilDataBaru(); }

        function tampilData(list) {
            const aktif = list.filter(l => !l.sudahDitangani);
            const selesai = list.filter(l => l.sudahDitangani);
            countAktif.innerText = aktif.length;
            countSelesai.innerText = selesai.length;

            const tampil = tabSekarang === 'aktif' ? aktif : selesai;
            konten.innerHTML = tampil.reverse().map(l => `
                <div class="p-6 rounded-[3rem] border-2 bg-slate-800 ${l.sudahDitangani ? 'border-slate-700' : 'border-red-600/40 emergency-glow'}">
                    <div class="flex justify-between mb-4">
                        <span class="text-[10px] text-slate-500 font-black">${l.waktu}</span>
                        <span class="text-[9px] px-3 py-1 rounded-full bg-red-600 font-black uppercase">${l.prioritas}</span>
                    </div>
                    <h3 class="text-2xl font-bold">"${l.teks}"</h3>
                </div>
            `).join('');
        }

        function selesai(id) {
            fetch(`${DB_URL.replace('.json','')}/${id}.json`, {
                method: 'PATCH',
                body: JSON.stringify({ sudahDitangani: true })
            }).then(ambilDataBaru);
        }
    </script>
</body>
</html>
